<!-- Page Header -->
<div class="page-header">
  <div>
    <div class="page-title">Planning agricole</div>
    <div class="page-subtitle">
      <span *ngIf="role === 'producteur'">Planifiez vos t√¢ches agricoles et g√©rez vos parcelles</span>
      <span *ngIf="role === 'cooperative'">G√©rez les campagnes collectives et les ressources</span>
      <span *ngIf="role === 'admin'">Supervision et gestion compl√®te du planning</span>
      <span *ngIf="role === 'technicien'">Vos t√¢ches assign√©es et mise √† jour des statuts</span>
      <span *ngIf="role === 'ong'">Calendrier des campagnes collectives</span>
      <span *ngIf="role === 'etat'">Dashboard national des campagnes agricoles</span>
      <span *ngIf="role === 'viewer'">Calendrier ‚Äî Consultation uniquement</span>
    </div>
  </div>
  <div class="page-actions">
    <button *ngIf="canCreateTask" class="primary-btn" (click)="openTaskModal()">
      <span class="material-symbols-outlined">add</span>
      Nouvelle t√¢che
    </button>
    <button *ngIf="canManageCampaign" class="ghost-btn" (click)="openCampaignModal()">
      <span class="material-symbols-outlined">campaign</span>
      Nouvelle campagne
    </button>
    <span *ngIf="isReadOnly" class="role-badge">
      <span class="material-symbols-outlined">visibility</span>
      {{ roleLabel }} ‚Äî Lecture seule
    </span>
  </div>
</div>

<!-- KPI Cards -->
<div class="grid-3">
  <div class="card stat-card">
    <div class="stat-icon"><span class="material-symbols-outlined">task_alt</span></div>
    <div>
      <div class="card-title">T√¢ches totales</div>
      <div class="stat-value">{{ tasks.length }}</div>
      <div class="stat-label">{{ completionRate }}% compl√©t√©es</div>
    </div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon warning"><span class="material-symbols-outlined">warning</span></div>
    <div>
      <div class="card-title">T√¢ches en retard</div>
      <div class="stat-value">{{ lateTasks.length }}</div>
      <div class="stat-label">√Ä traiter en priorit√©</div>
    </div>
  </div>
  <div class="card stat-card">
    <div class="stat-icon success"><span class="material-symbols-outlined">campaign</span></div>
    <div>
      <div class="card-title">Campagnes actives</div>
      <div class="stat-value">{{ campaigns.length }}</div>
      <div class="stat-label">{{ stats.totalParticipants }} participants</div>
    </div>
  </div>
</div>

<!-- ===================== TECHNICIEN VIEW ===================== -->
<div *ngIf="role === 'technicien'" class="section-gap">
  <div class="read-only-banner technicien-banner">
    <span class="material-symbols-outlined">engineering</span>
    Technicien ‚Äî Vous pouvez uniquement mettre √† jour le statut des t√¢ches qui vous sont assign√©es.
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">Mes t√¢ches assign√©es</div>
      <span class="badge">{{ myAssignedTasks.length }}</span>
    </div>
    <div class="task-list">
      <div *ngFor="let task of myAssignedTasks" class="task-item">
        <div class="task-icon" [style.background]="getTaskTypeColor(task.type)">
          <span class="material-symbols-outlined">{{ getTaskTypeIcon(task.type) }}</span>
        </div>
        <div class="task-content">
          <div class="task-title">{{ task.title }}</div>
          <div class="task-meta">
            <span>{{ task.parcel }}</span>
            <span class="separator">‚Ä¢</span>
            <span>{{ formatDate(task.date) }}</span>
            <span class="separator">‚Ä¢</span>
            <span class="priority-tag" [ngClass]="getPriorityClass(task.priority)">{{ task.priority }}</span>
          </div>
        </div>
        <div class="task-actions">
          <span class="status-badge" [ngClass]="getStatusClass(task.status)">
            {{ task.status === 'todo' ? '√Ä faire' : task.status === 'inprogress' ? 'En cours' : task.status === 'done' ?
            'Termin√©' : 'En retard' }}
          </span>
          <!-- TECHNICIEN can only update status -->
          <button class="ghost-btn small" (click)="openStatusModal(task)">
            <span class="material-symbols-outlined">edit</span>
            Statut
          </button>
        </div>
      </div>
      <div *ngIf="myAssignedTasks.length === 0" class="empty-state">
        <span class="material-symbols-outlined">assignment_turned_in</span>
        <p>Aucune t√¢che assign√©e</p>
      </div>
    </div>
  </div>

  <!-- Resources (technicien can update) -->
  <div class="card section-gap">
    <div class="card-header">
      <div class="card-title">Ressources disponibles</div>
    </div>
    <div class="resources-grid">
      <div *ngFor="let resource of resources" class="resource-card">
        <div class="resource-icon"><span class="material-symbols-outlined">build</span></div>
        <div class="resource-info">
          <strong>{{ resource.name }}</strong>
          <span class="resource-type">{{ resource.type }}</span>
        </div>
        <div class="resource-availability" [class.available]="resource.availability === 'Disponible'"
          [class.reserved]="resource.availability === 'R√©serv√©'">
          {{ resource.availability }}
        </div>
        <button class="icon-btn" title="R√©server" [disabled]="resource.availability !== 'Disponible'">
          <span class="material-symbols-outlined">bookmark_add</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== ONG VIEW ===================== -->
<div *ngIf="role === 'ong'" class="section-gap">
  <div class="read-only-banner ong-banner">
    <span class="material-symbols-outlined">volunteer_activism</span>
    ONG ‚Äî Consultation du calendrier des campagnes collectives
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">Campagnes collectives</div>
    </div>
    <div class="campaigns-grid">
      <div *ngFor="let campaign of campaigns" class="campaign-card">
        <div class="campaign-header">
          <span class="material-symbols-outlined">campaign</span>
          <h4>{{ campaign.name }}</h4>
        </div>
        <div class="campaign-details">
          <div class="campaign-detail"><span class="material-symbols-outlined">location_on</span>{{ campaign.zone }}
          </div>
          <div class="campaign-detail"><span class="material-symbols-outlined">calendar_today</span>{{
            formatDate(campaign.startDate) }} ‚Üí {{ formatDate(campaign.endDate) }}</div>
          <div class="campaign-detail"><span class="material-symbols-outlined">group</span>{{ campaign.participants }}
            participants</div>
        </div>
        <span class="status-badge" [ngClass]="getStatusClass(campaign.status)">{{ campaign.status }}</span>
      </div>
    </div>
  </div>

  <!-- Calendar view (read only) -->
  <div class="card section-gap">
    <div class="card-header">
      <div class="card-title">{{ monthNames[currentMonth] }} {{ currentYear }}</div>
      <div class="calendar-nav">
        <button class="icon-btn" (click)="previousMonth()"><span
            class="material-symbols-outlined">chevron_left</span></button>
        <button class="ghost-btn small" (click)="goToToday()">Aujourd'hui</button>
        <button class="icon-btn" (click)="nextMonth()"><span
            class="material-symbols-outlined">chevron_right</span></button>
      </div>
    </div>
    <div class="calendar-grid">
      <div class="calendar-header" *ngFor="let day of ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam']">{{ day }}</div>
      <div *ngFor="let day of calendarDays" class="calendar-day" [class.other-month]="!day.isCurrentMonth"
        [class.today]="day.isToday">
        <div class="day-number">{{ day.date.getDate() }}</div>
        <div *ngFor="let task of day.tasks.slice(0,2)" class="day-task"
          [style.background]="getTaskTypeColor(task.type)">
          {{ task.title }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===================== ETAT VIEW ===================== -->
<div *ngIf="role === 'etat'" class="section-gap">
  <div class="read-only-banner etat-banner">
    <span class="material-symbols-outlined">account_balance</span>
    Tableau de bord gouvernemental ‚Äî Monitoring des campagnes agricoles nationales
  </div>

  <div class="grid-3">
    <div class="card stat-card">
      <div class="stat-icon"><span class="material-symbols-outlined">campaign</span></div>
      <div>
        <div class="card-title">Campagnes nationales</div>
        <div class="stat-value">{{ campaigns.length }}</div>
        <div class="stat-label">En cours + planifi√©es</div>
      </div>
    </div>
    <div class="card stat-card">
      <div class="stat-icon success"><span class="material-symbols-outlined">group</span></div>
      <div>
        <div class="card-title">Participants totaux</div>
        <div class="stat-value">{{ stats.totalParticipants }}</div>
        <div class="stat-label">Agriculteurs engag√©s</div>
      </div>
    </div>
    <div class="card stat-card">
      <div class="stat-icon revenue"><span class="material-symbols-outlined">task_alt</span></div>
      <div>
        <div class="card-title">Taux de r√©alisation</div>
        <div class="stat-value">{{ completionRate }}%</div>
        <div class="stat-label">T√¢ches compl√©t√©es</div>
      </div>
    </div>
  </div>

  <div class="grid-2 section-gap">
    <div class="card">
      <div class="card-title">Campagnes nationales</div>
      <div class="campaigns-grid">
        <div *ngFor="let campaign of campaigns" class="campaign-card">
          <div class="campaign-header"><span class="material-symbols-outlined">campaign</span>
            <h4>{{ campaign.name }}</h4>
          </div>
          <div class="campaign-details">
            <div class="campaign-detail"><span class="material-symbols-outlined">location_on</span>{{ campaign.zone }}
            </div>
            <div class="campaign-detail"><span class="material-symbols-outlined">group</span>{{ campaign.participants }}
              participants</div>
            <div class="campaign-detail"><span class="material-symbols-outlined">calendar_today</span>{{
              formatDate(campaign.startDate) }} ‚Üí {{ formatDate(campaign.endDate) }}</div>
          </div>
          <div class="campaign-footer">
            <span class="status-badge" [ngClass]="getStatusClass(campaign.status)">{{ campaign.status }}</span>
            <!-- ETAT can participate in modifying campaigns -->
            <button *ngIf="canModifyCampaign" class="icon-btn" title="Modifier"><span
                class="material-symbols-outlined">edit</span></button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Bilan par statut de t√¢che</div>
      <div class="performance-stats">
        <div class="perf-item">
          <div class="perf-label">T√¢ches compl√©t√©es</div>
          <div class="perf-value">{{ doneTasks }}</div>
          <div class="perf-trend positive">{{ completionRate }}% du total</div>
        </div>
        <div class="perf-item">
          <div class="perf-label">En cours</div>
          <div class="perf-value">{{ inProgressTasks }}</div>
          <div class="perf-trend neutral">En progression</div>
        </div>
        <div class="perf-item">
          <div class="perf-label">En retard</div>
          <div class="perf-value">{{ lateTasks.length }}</div>
          <div class="perf-trend negative">Attention requise</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===================== VIEWER VIEW ===================== -->
<div *ngIf="role === 'viewer'" class="section-gap">
  <div class="read-only-banner">
    <span class="material-symbols-outlined">visibility</span>
    Acc√®s observateur ‚Äî Consultation du calendrier uniquement
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">{{ monthNames[currentMonth] }} {{ currentYear }}</div>
      <div class="calendar-nav">
        <button class="icon-btn" (click)="previousMonth()"><span
            class="material-symbols-outlined">chevron_left</span></button>
        <button class="ghost-btn small" (click)="goToToday()">Aujourd'hui</button>
        <button class="icon-btn" (click)="nextMonth()"><span
            class="material-symbols-outlined">chevron_right</span></button>
      </div>
    </div>
    <div class="calendar-grid">
      <div class="calendar-header" *ngFor="let day of ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam']">{{ day }}</div>
      <div *ngFor="let day of calendarDays" class="calendar-day" [class.other-month]="!day.isCurrentMonth"
        [class.today]="day.isToday">
        <div class="day-number">{{ day.date.getDate() }}</div>
        <div *ngFor="let task of day.tasks.slice(0,2)" class="day-task"
          [style.background]="getTaskTypeColor(task.type)">
          {{ task.title }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PRODUCTEUR / COOPERATIVE / ADMIN VIEW ===================== -->
<div *ngIf="role === 'producteur' || role === 'cooperative' || role === 'admin'" class="section-gap">

  <!-- Calendar Navigation -->
  <div class="card">
    <div class="card-header">
      <div class="view-controls">
        <button class="ghost-btn small" [class.active]="viewMode === 'month'" (click)="viewMode = 'month'">Mois</button>
        <button class="ghost-btn small" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">Liste</button>
      </div>
      <div class="calendar-nav">
        <button class="icon-btn" (click)="previousMonth()"><span
            class="material-symbols-outlined">chevron_left</span></button>
        <div class="month-title">{{ monthNames[currentMonth] }} {{ currentYear }}</div>
        <button class="icon-btn" (click)="nextMonth()"><span
            class="material-symbols-outlined">chevron_right</span></button>
        <button class="ghost-btn small" (click)="goToToday()">Aujourd'hui</button>
      </div>
    </div>

    <!-- Month Calendar -->
    <div *ngIf="viewMode === 'month'" class="calendar-grid">
      <div class="calendar-header" *ngFor="let day of ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam']">{{ day }}</div>
      <div *ngFor="let day of calendarDays" class="calendar-day" [class.other-month]="!day.isCurrentMonth"
        [class.today]="day.isToday" [class.selected]="selectedDate?.toDateString() === day.date.toDateString()"
        (click)="selectDate(day)">
        <div class="day-number">{{ day.date.getDate() }}</div>
        <div *ngFor="let task of day.tasks.slice(0, 2)" class="day-task"
          [style.background]="getTaskTypeColor(task.type)">
          {{ task.title }}
        </div>
        <div *ngIf="day.tasks.length > 2" class="day-more">+{{ day.tasks.length - 2 }}</div>
      </div>
    </div>

    <!-- List view -->
    <div *ngIf="viewMode === 'list'" class="task-list-view">
      <div class="filters">
        <select [(ngModel)]="selectedParcel" class="filter-select">
          <option value="all">Toutes les parcelles</option>
          <option *ngFor="let parcel of parcels" [value]="parcel">{{ parcel }}</option>
        </select>
        <select [(ngModel)]="selectedTaskType" class="filter-select">
          <option value="all">Tous les types</option>
          <option *ngFor="let type of taskTypes" [value]="type.value">{{ type.label }}</option>
        </select>
        <select [(ngModel)]="selectedStatus" class="filter-select">
          <option value="all">Tous les statuts</option>
          <option value="todo">√Ä faire</option>
          <option value="inprogress">En cours</option>
          <option value="done">Termin√©</option>
          <option value="late">En retard</option>
        </select>
      </div>

      <div class="task-list">
        <div *ngFor="let task of filteredTasks" class="task-item">
          <div class="task-icon" [style.background]="getTaskTypeColor(task.type)">
            <span class="material-symbols-outlined">{{ getTaskTypeIcon(task.type) }}</span>
          </div>
          <div class="task-content">
            <div class="task-title">{{ task.title }}</div>
            <div class="task-meta">
              <span>{{ task.parcel }}</span>
              <span class="separator">‚Ä¢</span>
              <span>{{ formatDate(task.date) }}</span>
              <span class="separator">‚Ä¢</span>
              <span class="priority-tag" [ngClass]="getPriorityClass(task.priority)">{{ task.priority }}</span>
              <span *ngIf="task.assignedTo" class="separator">‚Ä¢</span>
              <span *ngIf="task.assignedTo" class="assigned-to">üìå {{ task.assignedTo }}</span>
            </div>
          </div>
          <div class="task-actions">
            <span class="status-badge" [ngClass]="getStatusClass(task.status)">
              {{ task.status === 'todo' ? '√Ä faire' : task.status === 'inprogress' ? 'En cours' : task.status === 'done'
              ? 'Termin√©' : 'En retard' }}
            </span>
            <button *ngIf="canUpdateStatus" class="ghost-btn small" (click)="openStatusModal(task)">
              <span class="material-symbols-outlined">edit</span>
            </button>
            <button *ngIf="canDeleteTask" class="icon-btn danger" (click)="deleteTask(task)" title="Supprimer">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </div>
        </div>
        <div *ngIf="filteredTasks.length === 0" class="empty-state">
          <span class="material-symbols-outlined">event_busy</span>
          <p>Aucune t√¢che pour ces filtres</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming + Campaigns -->
  <div class="grid-2 section-gap">
    <!-- Upcoming tasks panel -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">Prochaines t√¢ches</div>
        <span class="badge">{{ upcomingTasks.length }}</span>
      </div>
      <div class="task-list">
        <div *ngFor="let task of upcomingTasks" class="task-item compact">
          <div class="task-icon small" [style.background]="getTaskTypeColor(task.type)">
            <span class="material-symbols-outlined">{{ getTaskTypeIcon(task.type) }}</span>
          </div>
          <div class="task-content">
            <div class="task-title">{{ task.title }}</div>
            <div class="task-meta"><span>{{ formatDate(task.date) }}</span><span class="separator">‚Ä¢</span><span>{{
                task.parcel }}</span></div>
          </div>
          <span class="status-badge small" [ngClass]="getStatusClass(task.status)">
            {{ task.status === 'todo' ? '√Ä faire' : 'En cours' }}
          </span>
        </div>
        <div *ngIf="upcomingTasks.length === 0" class="empty-state"><span
            class="material-symbols-outlined">event_available</span>
          <p>Aucune t√¢che √† venir</p>
        </div>
      </div>
    </div>

    <!-- Campaigns (COOPERATIVE + ADMIN) -->
    <div class="card" *ngIf="role === 'cooperative' || role === 'admin'">
      <div class="card-header">
        <div class="card-title">Campagnes</div>
        <button class="icon-btn" (click)="openCampaignModal()"><span
            class="material-symbols-outlined">add</span></button>
      </div>
      <div class="campaigns-grid">
        <div *ngFor="let campaign of campaigns" class="campaign-card">
          <div class="campaign-header"><span class="material-symbols-outlined">campaign</span>
            <h4>{{ campaign.name }}</h4>
          </div>
          <div class="campaign-details">
            <div class="campaign-detail"><span class="material-symbols-outlined">location_on</span>{{ campaign.zone }}
            </div>
            <div class="campaign-detail"><span class="material-symbols-outlined">group</span>{{ campaign.participants }}
              participants</div>
          </div>
          <div class="campaign-footer">
            <span class="status-badge" [ngClass]="getStatusClass(campaign.status)">{{ campaign.status }}</span>
            <button *ngIf="role === 'admin'" class="icon-btn" title="Supprimer"><span
                class="material-symbols-outlined">delete</span></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Resources (PRODUCTEUR view) -->
    <div class="card" *ngIf="role === 'producteur'">
      <div class="card-header">
        <div class="card-title">Ressources partag√©es</div>
      </div>
      <div class="resources-grid">
        <div *ngFor="let resource of resources" class="resource-card">
          <div class="resource-icon"><span class="material-symbols-outlined">build</span></div>
          <div class="resource-info"><strong>{{ resource.name }}</strong><span class="resource-type">{{ resource.type
              }}</span></div>
          <div class="resource-availability" [class.available]="resource.availability === 'Disponible'">{{
            resource.availability }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN ‚Äî Full resources management -->
  <div *ngIf="role === 'admin'" class="card section-gap">
    <div class="card-header">
      <div class="card-title">Gestion des ressources <span class="badge admin-badge">Admin</span></div>
      <button class="primary-btn" (click)="openResourceModal()">
        <span class="material-symbols-outlined">add</span> Ajouter ressource
      </button>
    </div>
    <div class="resources-grid">
      <div *ngFor="let resource of resources" class="resource-card">
        <div class="resource-icon"><span class="material-symbols-outlined">build</span></div>
        <div class="resource-info"><strong>{{ resource.name }}</strong><span class="resource-type">{{ resource.type
            }}</span></div>
        <div class="resource-availability" [class.available]="resource.availability === 'Disponible'"
          [class.reserved]="resource.availability === 'R√©serv√©'">{{ resource.availability }}</div>
        <div class="action-btns">
          <button class="icon-btn"><span class="material-symbols-outlined">edit</span></button>
          <button class="icon-btn danger"><span class="material-symbols-outlined">delete</span></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Late tasks alert -->
  <div *ngIf="lateTasks.length > 0" class="card section-gap late-alert">
    <div class="card-header">
      <div class="card-title">
        <span class="material-symbols-outlined text-danger">warning</span>
        T√¢ches en retard ({{ lateTasks.length }})
      </div>
    </div>
    <div class="task-list">
      <div *ngFor="let task of lateTasks" class="task-item">
        <div class="task-icon late" [style.background]="getTaskTypeColor(task.type)">
          <span class="material-symbols-outlined">{{ getTaskTypeIcon(task.type) }}</span>
        </div>
        <div class="task-content">
          <div class="task-title">{{ task.title }}</div>
          <div class="task-meta"><span>{{ task.parcel }}</span><span class="separator">‚Ä¢</span><span>{{
              formatDate(task.date) }}</span></div>
        </div>
        <div class="task-actions">
          <button *ngIf="canUpdateStatus" class="primary-btn small" (click)="updateTaskStatus(task, 'inprogress')">
            Commencer
          </button>
          <button *ngIf="canDeleteTask" class="icon-btn danger" (click)="deleteTask(task)" title="Supprimer">
            <span class="material-symbols-outlined">delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MODALS ===================== -->

<!-- Task Modal (PRODUCTEUR / COOPERATIVE / ADMIN) -->
<div *ngIf="showTaskModal && canCreateTask" class="modal-overlay" (click)="closeTaskModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Nouvelle t√¢che</h3>
      <button class="icon-btn" (click)="closeTaskModal()"><span class="material-symbols-outlined">close</span></button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Titre</label>
        <input type="text" [(ngModel)]="newTask.title" class="form-input" placeholder="Ex: Irrigation parcelle A">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Type</label>
          <select [(ngModel)]="newTask.type" class="form-input">
            <option *ngFor="let type of taskTypes" [value]="type.value">{{ type.label }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Parcelle</label>
          <select [(ngModel)]="newTask.parcel" class="form-input">
            <option value="">S√©lectionner</option>
            <option *ngFor="let parcel of parcels" [value]="parcel">{{ parcel }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Date</label>
          <input type="date" [(ngModel)]="newTask.date" class="form-input">
        </div>
        <div class="form-group">
          <label>Priorit√©</label>
          <select [(ngModel)]="newTask.priority" class="form-input">
            <option value="low">Basse</option>
            <option value="medium">Moyenne</option>
            <option value="high">Haute</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="newTask.description" class="form-input" rows="3"
          placeholder="D√©tails optionnels..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="ghost-btn" (click)="closeTaskModal()">Annuler</button>
      <button class="primary-btn" (click)="submitTask()">Cr√©er la t√¢che</button>
    </div>
  </div>
</div>

<!-- Status Update Modal (TECHNICIEN + ADMIN) -->
<div *ngIf="showStatusModal && canUpdateStatus && selectedTaskForStatus" class="modal-overlay"
  (click)="closeStatusModal()">
  <div class="modal small-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Mettre √† jour le statut</h3>
      <button class="icon-btn" (click)="closeStatusModal()"><span
          class="material-symbols-outlined">close</span></button>
    </div>
    <div class="modal-body">
      <p class="task-name-preview">{{ selectedTaskForStatus.title }}</p>
      <div class="status-options">
        <button class="status-option todo" (click)="updateTaskStatus(selectedTaskForStatus!, 'todo')">
          <span class="material-symbols-outlined">radio_button_unchecked</span> √Ä faire
        </button>
        <button class="status-option inprogress" (click)="updateTaskStatus(selectedTaskForStatus!, 'inprogress')">
          <span class="material-symbols-outlined">pending</span> En cours
        </button>
        <button class="status-option done" (click)="updateTaskStatus(selectedTaskForStatus!, 'done')">
          <span class="material-symbols-outlined">check_circle</span> Termin√©
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Campaign Modal (COOPERATIVE / ADMIN) -->
<div *ngIf="showCampaignModal && canManageCampaign" class="modal-overlay" (click)="closeCampaignModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Nouvelle campagne</h3>
      <button class="icon-btn" (click)="closeCampaignModal()"><span
          class="material-symbols-outlined">close</span></button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Nom de la campagne</label>
        <input type="text" [(ngModel)]="newCampaign.name" class="form-input" placeholder="Ex: Campagne printemps 2026">
      </div>
      <div class="form-group">
        <label>Zone g√©ographique</label>
        <input type="text" [(ngModel)]="newCampaign.zone" class="form-input" placeholder="Ex: Zone Nord">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Date de d√©but</label>
          <input type="date" [(ngModel)]="newCampaign.startDate" class="form-input">
        </div>
        <div class="form-group">
          <label>Date de fin</label>
          <input type="date" [(ngModel)]="newCampaign.endDate" class="form-input">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="ghost-btn" (click)="closeCampaignModal()">Annuler</button>
      <button class="primary-btn" (click)="submitCampaign()">Cr√©er la campagne</button>
    </div>
  </div>
</div>